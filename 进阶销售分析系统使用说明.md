# 进阶销售分析系统使用说明

## 系统概述

本系统是基于企业微信的进阶销售数据分析系统，能够按照组织架构自动拆分销售数据，生成专业的销售报告，并发送给相应部门的所有人员。

## 系统特性

- 🏢 **组织架构分组**：按业务分组（4个事业部）和渠道分组（3个渠道）
- 📊 **智能数据分析**：自动处理ERP数据，生成统计报告
- 📱 **企业微信集成**：直接发送消息到企业微信相应部门
- ⚙️ **灵活配置**：支持自定义分组规则和报告模板
- 🔍 **健康检查**：系统状态监控和故障诊断

## 业务分组规则

### 品类分组（4个事业部）

1. **空调事业部**
   - 包含：家用空调、商用空调品类
   - 关键词：空调、挂机、柜机、中央空调、多联机

2. **冰冷事业部**
   - 包含：冰箱、冷柜品类
   - 关键词：冰箱、冷柜、冷藏、冷冻

3. **洗护事业部**
   - 包含：洗衣机品类
   - 关键词：洗衣机、干衣机、洗烘一体

4. **厨卫事业部**
   - 包含：水联网事业部（热水器）+ 厨电洗碗机事业部
   - 关键词：热水器、厨电、洗碗机、燃气灶

### 渠道分组（3个渠道）

1. **抖音项目**
   - 包含：抖音+快手渠道店铺
   - 关键词：抖音、快手、短视频

2. **卡萨帝项目**
   - 包含：所有带卡萨帝字样的店铺
   - 关键词：卡萨帝、casarte

3. **拼多多渠道**
   - 包含：拼多多渠道所有店铺
   - 关键词：拼多多、pdd

## 报告格式

### 业务分组报告格式

```
2025-07-01 XX事业部 销售分析：

整体销售 XXX，前一天 XXX，环比 XXX，销售数量 XXX，单价 XXX

TOP 店铺数据：
家用空调
XXX（店铺），销售 XXX，前一天 XXX，环比 XXX，销售数量 XXX，单价 XXX
单品 TOP1 XXX，销售 XXX，销售数量 XXX，前一天 XXX，环比 XXX
TOP2 XXX，销售 XXX，销售数量 XXX，前一天 XXX，环比 XXX
...

商用空调
XXX（店铺），销售 XXX，前一天 XXX，环比 XXX，销售数量 XXX，单价 XXX
...

核心单品销售明细（累计整体单品 top）
TOP1 XXX，销售 XXX，销售数量 XXX，前一天 XXX，环比 XXX
TOP2 XXX，销售 XXX，销售数量 XXX，前一天 XXX，环比 XXX
...
```

### 渠道分组报告格式

```
2025-07-01 XX渠道 销售分析：

整体销售 XXX，前一天 XXX，环比 XXX，销售数量 XXX，单价 XXX

店铺数据：
店铺1 XXX，销售 XXX，前一天 XXX，环比 XXX，销售数量 XXX，单价 XXX
...

单品数据：
TOP1 单品，销售 XXX，前一天 XXX，环比 XXX，销售数量 XXX，单价 XXX
TOP2 单品，销售 XXX，前一天 XXX，环比 XXX，销售数量 XXX，单价 XXX
...
```

## 系统安装

### 环境要求

- Python 3.7+
- pandas, requests, openpyxl 等依赖包
- 企业微信服务器访问权限

### 安装步骤

1. **安装依赖**
```bash
pip install pandas requests openpyxl
```

2. **配置文件设置**
编辑 `sales_config.json` 文件：
```json
{
  "paths": {
    "erp_folder": "E:\\电商数据\\虹图\\ERP订单明细"  // 修改为实际ERP数据路径
  },
  "server": {
    "wecomchan_server_url": "http://212.64.57.87:5001",  // 企业微信服务器地址
    "token": "wecomchan_token"  // 访问令牌
  }
}
```

3. **数据格式要求**
ERP文件应包含以下列：
- 店铺（店铺名称）
- 商品名称
- 销售额
- 销售数量
- 日期

## 使用方法

### 1. 命令行使用

```bash
# 系统健康检查
python advanced_sales_system.py health

# 生成报告（不发送）
python advanced_sales_system.py report

# 生成并发送报告
python advanced_sales_system.py report 2024-01-15 send

# 交互模式
python advanced_sales_system.py interactive
```

### 2. 交互模式使用

运行系统后选择相应操作：

```
📋 可用操作:
1. 系统健康检查
2. 生成日报 (不发送)
3. 生成并发送日报
4. 测试消息发送
5. 查看配置
6. 查看组织架构
0. 退出
```

### 3. 编程接口使用

```python
from advanced_sales_system import AdvancedSalesSystem

# 创建系统实例
system = AdvancedSalesSystem()

# 健康检查
system.check_system_health()

# 生成报告
result = system.generate_daily_reports("2024-01-15", auto_send=True)
print(result)
```

## 配置说明

### 业务分组配置

```json
"business_groups": {
  "空调事业部": {
    "department_keywords": ["空调", "家用空调", "商用空调"],
    "product_keywords": ["空调", "挂机", "柜机"],
    "shop_keywords": ["空调", "海尔空调"],
    "categories": ["家用空调", "商用空调"]
  }
}
```

### 报告配置

```json
"report": {
  "max_top_shops": 5,       // 最多显示店铺数
  "max_top_products": 10,   // 最多显示商品数
  "max_shop_products": 5    // 每店铺最多显示商品数
}
```

### 消息模板配置

```json
"message_templates": {
  "business_group_header": "{date} {group_name} 销售分析：",
  "overall_summary": "整体销售 {sales}，前一天 {prev_sales}，环比 {growth}"
}
```

## 故障排除

### 常见问题

1. **找不到ERP文件**
   - 检查 `erp_folder` 路径是否正确
   - 确认文件名格式符合要求

2. **企业微信连接失败**
   - 检查服务器地址和端口
   - 确认网络连接正常
   - 验证访问令牌

3. **数据处理错误**
   - 检查ERP文件格式
   - 确认必需列存在
   - 查看数据清洗配置

4. **消息发送失败**
   - 检查消息长度是否超限
   - 确认部门ID正确
   - 查看企业微信权限

### 调试方法

1. **启用详细日志**
```json
"logging": {
  "level": "DEBUG"
}
```

2. **健康检查**
```bash
python advanced_sales_system.py health
```

3. **测试单个功能**
```python
# 测试数据加载
processor = SalesDataProcessor()
data = processor.load_sales_data("2024-01-15")

# 测试消息发送
sender = WeComMessageSender()
result = sender.test_server_connection()
```

## 系统架构

### 核心模块

1. **sales_config.py** - 配置管理
2. **sales_data_processor.py** - 数据处理
3. **sales_report_generator.py** - 报告生成
4. **wecom_message_sender.py** - 消息发送
5. **advanced_sales_system.py** - 主控制器

### 数据流程

```
ERP文件 → 数据加载 → 数据清洗 → 分组处理 → 报告生成 → 消息发送 → 企业微信
```

### 依赖关系

```
advanced_sales_system.py
├── sales_config.py
├── sales_data_processor.py
├── sales_report_generator.py
└── wecom_message_sender.py
```

## 扩展和定制

### 添加新的业务分组

1. 在 `sales_config.json` 中添加新分组
2. 配置关键词匹配规则
3. 重启系统测试

### 自定义报告格式

1. 修改 `message_templates` 配置
2. 扩展 `SalesReportGenerator` 类
3. 添加新的格式化方法

### 集成其他平台

1. 实现新的消息发送器
2. 遵循现有接口规范
3. 在主控制器中注册

## 维护和监控

### 定时任务设置

使用 crontab 设置自动执行：
```bash
# 每天早上8点生成并发送昨天的报告
0 8 * * * cd /path/to/system && python advanced_sales_system.py report send
```

### 日志监控

系统会自动生成日志文件，建议定期检查：
- 系统运行状态
- 错误和异常
- 性能指标

### 数据备份

建议定期备份：
- 配置文件
- 历史报告
- 系统日志

## 联系支持

如遇到技术问题，请提供：
1. 错误信息和日志
2. 系统配置文件
3. 操作步骤说明

---

*系统版本：1.0.0*  
*更新日期：2024-01-15* 