# 多店铺分销价格监控脚本使用说明

## 功能概述

本脚本用于监控多个店铺的分销价格变化，自动比较T-1天与当天的价格差异，并将变动信息发送到企业微信群。**当检测到价格变动时，会同时发送完整的Excel表格信息到群里。**

## 主要功能

1. **多店铺数据处理**：自动扫描指定目录下的所有Excel文件
2. **价格变动检测**：比较当天与昨天的同型号价格
3. **自动备注更新**：在当天数据表的备注列记录价格变动
4. **企业微信推送**：将价格变动信息发送到指定的企业微信群
5. **Excel表格发送**：**当有价格变动时，发送完整的Excel表格信息到群里**
6. **支持多种文件格式**：兼容不同的日期命名格式

## 文件结构要求

### 目录结构
```
E:\文档\虹图分销价\
├── 店铺A_20250127.xlsx
├── 店铺A_20250126.xlsx
├── 店铺B_20250127.xlsx
├── 店铺B_20250126.xlsx
└── ...
```

### Excel文件格式要求
- **必需列**：
  - `型号`：产品型号（支持"序号 型号名"格式）
  - `采购价(元)`：价格数据
  - `日期`：数据日期
- **可选列**：
  - `备注`：用于记录价格变动信息

### 支持的文件命名格式
1. `店铺名_20250127.xlsx`（推荐）
2. `店铺名_2025-01-27.xlsx`
3. `店铺名_2025_01_27.xlsx`

## 使用方法

### 1. 影刀中直接执行
将 `multi_shop_price_monitor.py` 脚本复制到影刀中，直接运行即可。

### 2. 手动执行
```bash
python multi_shop_price_monitor.py
```

## 配置参数

脚本开头的配置参数可以根据需要修改：

```python
# 数据文件路径
base_path = "E:\\文档\\虹图分销价\\"

# 企业微信机器人Webhook地址
webhook_url = "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=82af531b-4941-4b70-9509-455e75690463"
```

## 执行流程

1. **扫描文件**：自动扫描指定目录下的所有Excel文件
2. **数据预处理**：
   - 清理型号名称（去除序号）
   - 转换日期和价格格式
3. **价格比较**：
   - 查找昨天同店铺的数据文件
   - 比较同型号的价格变化
4. **数据更新**：
   - 在当天数据表的备注列记录变动信息
   - 保存更新后的Excel文件
5. **消息推送**：
   - 构建企业微信消息
   - 发送价格变动信息到指定的群组
6. **Excel表格发送**：
   - **当检测到价格变动时，发送完整的Excel表格信息**
   - 包含文件路径和下载信息

## 输出信息

### 控制台输出
- 处理进度和状态信息
- 错误和警告信息
- 最终统计汇总

### 企业微信消息格式

#### 1. 价格变动信息
```
📊 **店铺名 分销价格监控报告**
📅 日期：2025-01-27

🔍 **价格变动详情：**
📈 型号A: 100元 → 120元 (+20元)
📉 型号B: 200元 → 180元 (-20元)

📋 **变动统计：**
• 变动型号数量：2个
• 总数据量：50个型号
```

#### 2. Excel表格信息（当有价格变动时）
```
📊 **店铺名 完整分销价格表**
📅 日期：2025-01-27
📎 文件名：店铺名_20250127_分销价格表.xlsx
📁 文件路径：E:\文档\虹图分销价\店铺名_20250127.xlsx
💡 请从上述路径获取完整的Excel文件
```

## 发送逻辑

- **无价格变动**：只发送价格监控报告
- **有价格变动**：发送价格监控报告 + Excel表格信息

## 错误处理

### 常见问题及解决方案

1. **找不到文件**
   - 检查文件路径是否正确
   - 确认文件命名格式是否符合要求

2. **数据格式错误**
   - 检查Excel文件是否包含必需的列
   - 确认日期和价格数据格式正确

3. **企业微信发送失败**
   - 检查Webhook地址是否正确
   - 确认网络连接正常

4. **Excel表格发送失败**
   - 检查文件路径是否存在
   - 确认文件权限是否正确

## 注意事项

1. **数据备份**：建议在运行前备份原始数据文件
2. **文件权限**：确保脚本有读写Excel文件的权限
3. **网络连接**：需要网络连接才能发送企业微信消息
4. **时间设置**：建议每天定时执行，确保数据及时更新
5. **Excel表格获取**：当有价格变动时，可以从消息中提供的文件路径获取完整的Excel表格

## 扩展功能

如需添加其他功能，可以修改脚本中的相关部分：

- **价格阈值**：添加价格变动的最小阈值判断
- **消息格式**：自定义企业微信消息的显示格式
- **数据验证**：增加更严格的数据验证规则
- **日志记录**：添加详细的日志记录功能
- **文件上传**：如果需要直接上传Excel文件到企业微信，需要额外的API支持 