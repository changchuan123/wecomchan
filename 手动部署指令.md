# æ‰‹åŠ¨éƒ¨ç½²è¯¦ç»†æŒ‡ä»¤

## ðŸŽ¯ å¿«é€Ÿéƒ¨ç½²ï¼ˆæŽ¨èï¼‰

å¦‚æžœä½ æœ‰SSHè®¿é—®æƒé™ï¼Œç›´æŽ¥è¿è¡Œè‡ªåŠ¨åŒ–è„šæœ¬ï¼š

```bash
# åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•æ‰§è¡Œ
./deploy.sh
```

## ðŸ“‹ æ‰‹åŠ¨éƒ¨ç½²è¯¦ç»†æ­¥éª¤

### æ­¥éª¤1: è¿žæŽ¥åˆ°è¿œç¨‹æœåŠ¡å™¨
```bash
# ä½¿ç”¨SSHè¿žæŽ¥ï¼ˆæ›¿æ¢ä¸ºä½ çš„å®žé™…ç”¨æˆ·åï¼‰
ssh root@212.64.57.87
```

### æ­¥éª¤2: åœæ­¢æ—§æœåŠ¡
```bash
# æŸ¥çœ‹å½“å‰è¿è¡Œçš„æœåŠ¡
ps aux | grep wecomchan
netstat -tlnp | grep 5001

# åœæ­¢æ—§æœåŠ¡
pkill -f wecomchan_server.py
pkill -f wecomchan_server_updated.py

# ç¡®è®¤æœåŠ¡å·²åœæ­¢
ps aux | grep wecomchan
```

### æ­¥éª¤3: å¤‡ä»½åŽŸæœ‰æ–‡ä»¶
```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
BACKUP_DIR=~/wecomchan_backup/$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR

# å¤‡ä»½çŽ°æœ‰Pythonæ–‡ä»¶
cp *.py $BACKUP_DIR/ 2>/dev/null || true
echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
```

### æ­¥éª¤4: ä¸Šä¼ æ–°æ–‡ä»¶
åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œï¼ˆä¸æ˜¯åœ¨SSHä¼šè¯ä¸­ï¼‰ï¼š
```bash
# ä¸Šä¼ æ›´æ–°åŽçš„æœåŠ¡å™¨æ–‡ä»¶
scp wecomchan_server_updated.py root@212.64.57.87:/root/
```

### æ­¥éª¤5: å®‰è£…/æ£€æŸ¥ä¾èµ–
å›žåˆ°SSHä¼šè¯ä¸­ï¼š
```bash
# æ£€æŸ¥ä¾èµ–
python3 -c "import flask, requests"

# å¦‚æžœç¼ºå°‘ä¾èµ–ï¼Œå®‰è£…å®ƒä»¬
pip3 install flask requests --user
# æˆ–è€…å¦‚æžœæœ‰æƒé™
pip3 install flask requests
```

### æ­¥éª¤6: å¯åŠ¨æ–°æœåŠ¡
```bash
# åŽå°å¯åŠ¨æœåŠ¡
nohup python3 wecomchan_server_updated.py > wecomchan.log 2>&1 &

# ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 5

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
ps aux | grep wecomchan_server_updated.py
netstat -tlnp | grep 5001
```

### æ­¥éª¤7: éªŒè¯æœåŠ¡
```bash
# æœ¬åœ°å¥åº·æ£€æŸ¥
curl http://localhost:5001/health

# æµ‹è¯•éƒ¨é—¨åˆ—è¡¨
curl "http://localhost:5001/departments?token=wecomchan_token"

# æŸ¥çœ‹æ—¥å¿—
tail -f wecomchan.log
```

## ðŸ”§ æ•…éšœæŽ’é™¤

### å¦‚æžœæœåŠ¡å¯åŠ¨å¤±è´¥ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
cat wecomchan.log

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 5001
ss -tlnp | grep 5001

# æ‰‹åŠ¨å¯åŠ¨æŸ¥çœ‹é”™è¯¯
python3 wecomchan_server_updated.py
```

### å¦‚æžœä¾èµ–å®‰è£…å¤±è´¥ï¼š
```bash
# æ›´æ–°pip
python3 -m pip install --upgrade pip --user

# ä½¿ç”¨æ¸…åŽæºå®‰è£…
pip3 install flask requests -i https://pypi.tuna.tsinghua.edu.cn/simple/ --user
```

### å¦‚æžœå¤–ç½‘æ— æ³•è®¿é—®ï¼š
1. æ£€æŸ¥è…¾è®¯äº‘å®‰å…¨ç»„è®¾ç½®
2. æ£€æŸ¥æœ¬åœ°é˜²ç«å¢™ï¼š
```bash
# CentOS/RHEL
firewall-cmd --list-all
firewall-cmd --add-port=5001/tcp --permanent
firewall-cmd --reload

# Ubuntu/Debian
ufw status
ufw allow 5001
```

## ðŸ“Š éªŒè¯éƒ¨ç½²æˆåŠŸ

åœ¨æœ¬åœ°æµ‹è¯•è¿œç¨‹æœåŠ¡ï¼š
```bash
# å¥åº·æ£€æŸ¥
curl http://212.64.57.87:5001/health

# éƒ¨é—¨åˆ—è¡¨
curl "http://212.64.57.87:5001/departments?token=wecomchan_token"

# è¿è¡Œå®Œæ•´æµ‹è¯•
python3 server_test.py
```

## ðŸŽ‰ éƒ¨ç½²å®ŒæˆåŽçš„æœåŠ¡åœ°å€

- **å¥åº·æ£€æŸ¥**: http://212.64.57.87:5001/health
- **å‘é€æ¶ˆæ¯**: http://212.64.57.87:5001/send
- **éƒ¨é—¨åˆ—è¡¨**: http://212.64.57.87:5001/departments?token=wecomchan_token
- **ç”¨æˆ·åˆ—è¡¨**: http://212.64.57.87:5001/users?token=wecomchan_token
- **å®Œæ•´ç»„ç»‡æž¶æž„**: http://212.64.57.87:5001/organization?token=wecomchan_token

## ðŸ“ ç»´æŠ¤å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
ssh root@212.64.57.87 'ps aux | grep wecomchan'

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
ssh root@212.64.57.87 'tail -f wecomchan.log'

# é‡å¯æœåŠ¡
ssh root@212.64.57.87 'pkill -f wecomchan_server_updated.py && nohup python3 wecomchan_server_updated.py > wecomchan.log 2>&1 &'
``` 