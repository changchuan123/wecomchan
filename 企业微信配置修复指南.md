# 企业微信配置修复指南

## 🚨 问题描述

服务器 `212.64.57.87:5001` 的企业微信推送功能出现 `invalid corpid` 错误，需要修复服务器端配置。

## 🔧 修复步骤

### 1. 检查当前配置
登录服务器 `212.64.57.87`，检查企业微信配置：

```bash
# 检查环境变量
echo $WECOM_CID
echo $WECOM_SECRET  
echo $WECOM_AID
```

### 2. 更新企业微信配置
使用以下正确的配置：

```bash
# 设置环境变量
export WECOM_CID="ww5396d87e63595849"
export WECOM_SECRET="HakXD1he7FuOdgTUQonX562Xy7T1tRdB4-sdZ8F57II"
export WECOM_AID="1000011"
export WECOM_TOUID="@all"
```

### 3. 验证配置
测试企业微信配置是否有效：

```bash
# 测试获取access_token
curl "https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=ww5396d87e63595849&corpsecret=HakXD1he7FuOdgTUQonX562Xy7T1tRdB4-sdZ8F57II"
```

### 4. 重启服务
重启企业微信推送服务：

```bash
# 重启服务
sudo systemctl restart wecomchan
# 或者
pm2 restart wecomchan
```

### 5. 测试推送
测试推送功能是否正常：

```bash
curl -X POST "http://212.64.57.87:5001/send" \
  -H "Content-Type: application/json" \
  -d '{"msg":"测试企业微信推送","token":"wecomchan_token","to_user":"weicungang"}'
```

## 📋 配置信息

### 企业微信应用配置
- **公司ID (corpid)**: `ww5396d87e63595849`
- **应用Secret**: `HakXD1he7FuOdgTUQonX562Xy7T1tRdB4-sdZ8F57II`
- **应用ID (agentid)**: `1000011`
- **接收用户**: `@all`

### 服务器信息
- **服务器地址**: `212.64.57.87:5001`
- **API端点**: `/send`
- **认证token**: `wecomchan_token`

## 🔍 故障排除

### 如果仍然出现 invalid corpid 错误：

1. **检查企业微信应用状态**
   - 登录企业微信管理后台
   - 确认应用是否正常启用
   - 检查应用权限设置

2. **验证公司ID**
   - 确认公司ID是否正确
   - 检查公司是否已认证

3. **检查应用Secret**
   - 重新生成应用Secret
   - 确保Secret没有过期

4. **网络连接**
   - 确认服务器能访问企业微信API
   - 检查防火墙设置

## 📞 联系信息

如需技术支持，请联系：
- 服务器管理员
- 企业微信应用管理员

## ✅ 验证清单

- [ ] 环境变量设置正确
- [ ] 企业微信应用配置有效
- [ ] 服务重启成功
- [ ] 推送测试通过
- [ ] 状态检查正常 