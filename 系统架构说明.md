# 海尔销售分析系统架构说明

## 📋 系统概述

本系统采用分布式架构，包含影刀RPA数据处理模块和EdgeOne静态网站托管服务，实现销售数据的自动化分析、报告生成和在线展示。

## 🏗️ 架构组件

### 1. 影刀RPA执行环境
- **运行平台**: Windows机器
- **执行方式**: 影刀RPA自动化执行
- **数据源**: 数据库（非本地文件）
- **主要功能**:
  - 从数据库读取ERP销售数据
  - 按组织架构进行数据分析和分组
  - 生成HTML销售报告
  - 通过企业微信推送报告
  - 将报告部署到EdgeOne服务

### 2. EdgeOne静态网站服务
- **运行平台**: 远程服务器
- **服务地址**: `https://edge.haierht.cn`
- **主要功能**:
  - 托管HTML报告文件
  - 提供CDN加速访问
  - 支持自定义域名
  - 静态文件分发

### 3. 企业微信服务器
- **服务地址**: `212.64.57.87:5001`
- **主要功能**:
  - 企业微信消息推送
  - 组织架构管理
  - 用户权限控制

## 🔄 数据流程

```
数据库 → 影刀RPA(Windows) → HTML报告 → EdgeOne服务(远程) → 用户访问
   ↓
企业微信推送
```

### 详细流程说明

1. **数据获取阶段**
   - 影刀RPA脚本在Windows机器上执行
   - 直接连接数据库读取ERP销售数据
   - 无需本地文件，实时获取最新数据

2. **数据处理阶段**
   - 智能字段识别和映射
   - 按业务分组（空调、冰冷、洗护、厨卫事业部）
   - 按渠道分组（抖音、卡萨帝、拼多多）
   - 生成分析报告和图表

3. **报告生成阶段**
   - 生成带时间戳的HTML报告文件
   - 包含交互式图表和数据表格
   - 支持响应式设计，适配多设备

4. **部署发布阶段**
   - 通过EdgeOne CLI将报告部署到远程服务器
   - 自动配置CDN和域名解析
   - 生成可访问的公网链接

5. **消息推送阶段**
   - 根据组织架构获取相关人员列表
   - 通过企业微信推送报告链接
   - 支持按部门和角色精准推送

## 🛠️ 技术栈

### 影刀RPA端（Windows）
- **语言**: Python 3.x
- **核心库**: pandas, requests, json
- **数据处理**: 智能字段映射、数据分组分析
- **报告生成**: HTML + Chart.js 交互式图表
- **部署工具**: EdgeOne CLI

### EdgeOne服务端（远程）
- **平台**: EdgeOne Pages
- **域名**: edge.haierht.cn
- **CDN**: 腾讯云EdgeOne
- **配置**: 自定义域名、HTTPS、重定向规则

### 企业微信服务
- **API**: 企业微信开放平台
- **功能**: 消息推送、组织架构、用户管理

## 📁 项目结构

```
项目根目录/
├── 影刀RPA脚本/
│   ├── yingdao_sales_executor.py     # 主执行脚本
│   ├── 整体日报数据.py               # 日报生成
│   ├── 整体周报数据.py               # 周报生成
│   └── 整体月报数据.py               # 月报生成
├── EdgeOne配置/
│   ├── .edgeone/project.json        # 项目配置
│   ├── edgeone.json                 # 部署配置
│   └── deploy_to_edgeone.py         # 部署脚本
├── 报告输出/
│   └── reports/                     # HTML报告目录
└── 文档/
    ├── 影刀RPA使用指南.md
    ├── 影刀RPA执行说明.md
    └── 远程部署指南.md
```

## 🔧 配置要点

### 影刀RPA配置
- 数据库连接配置
- 企业微信服务器地址: `212.64.57.87:5001`
- EdgeOne部署令牌配置
- 组织架构部门ID映射

### EdgeOne配置
- 项目名称: `sales-report`
- 自定义域名: `edge.haierht.cn`
- 构建输出目录: `reports`
- CDN缓存策略和重定向规则

## 🚀 部署流程

1. **影刀RPA执行**
   ```bash
   # 在Windows机器上通过影刀RPA执行
   python yingdao_sales_executor.py
   ```

2. **自动部署到EdgeOne**
   ```bash
   # 脚本内自动调用
   python deploy_to_edgeone.py
   ```

3. **验证部署结果**
   ```bash
   # 验证域名配置
   python verify_domain_config.py
   ```

## 📊 监控和维护

- **域名状态**: 定期检查DNS解析和SSL证书
- **服务健康**: 监控EdgeOne服务可用性
- **数据质量**: 验证数据库连接和数据完整性
- **推送状态**: 监控企业微信消息推送成功率

## 🔒 安全考虑

- 数据库连接加密
- 企业微信Token安全存储
- EdgeOne部署令牌保护
- HTTPS强制访问
- 访问日志记录

## 📈 性能优化

- CDN缓存策略优化
- 数据库查询优化
- HTML报告压缩
- 图片和资源优化
- 并发处理能力提升